<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spirits Image Matcher</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #8B0000;
            margin-bottom: 20px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .stat {
            flex: 1;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #8B0000;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .image-section, .product-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
        }
        .image-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .image-container img {
            max-width: 100%;
            max-height: 400px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }
        .image-info {
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }
        .product-list {
            max-height: 600px;
            overflow-y: auto;
        }
        .product-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .product-item:hover {
            border-color: #8B0000;
            background: #fff5f5;
        }
        .product-item.matched {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .product-name {
            font-weight: bold;
            color: #333;
        }
        .product-details {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #8B0000;
            color: white;
        }
        .btn-primary:hover {
            background: #a00000;
        }
        .btn-secondary {
            background: #666;
            color: white;
        }
        .btn-secondary:hover {
            background: #777;
        }
        .btn-success {
            background: #4caf50;
            color: white;
        }
        .btn-success:hover {
            background: #45a049;
        }
        .search-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .mapping-results {
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 5px;
        }
        .mapping-item {
            padding: 5px;
            margin: 5px 0;
            background: white;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç∑ Spirits Image Matcher</h1>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="totalImages">98</div>
                <div class="stat-label">Total Images</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalProducts">83</div>
                <div class="stat-label">Total Products</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="matchedCount">0</div>
                <div class="stat-label">Matched</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="remainingCount">98</div>
                <div class="stat-label">Remaining</div>
            </div>
        </div>

        <div class="main-content">
            <div class="image-section">
                <h2>Current Image</h2>
                <div class="image-container">
                    <img id="currentImage" src="" alt="Spirit Image">
                    <div class="image-info" id="imageInfo">image00001.jpeg</div>
                </div>
                <div class="controls">
                    <button class="btn-secondary" onclick="previousImage()">‚Üê Previous</button>
                    <button class="btn-secondary" onclick="nextImage()">Next ‚Üí</button>
                    <button class="btn-success" onclick="markAsNewProduct()">New Product</button>
                </div>
            </div>

            <div class="product-section">
                <h2>Select Product</h2>
                <input type="text" class="search-box" id="searchBox" placeholder="Search products..." oninput="filterProducts()" onkeyup="filterProducts()">
                <div class="product-list" id="productList"></div>
                <div class="controls">
                    <button class="btn-primary" onclick="matchAsMain()">Match as Main Image</button>
                    <button class="btn-primary" onclick="matchAsGallery()">Match as Gallery Image</button>
                </div>
            </div>
        </div>

        <div class="mapping-results">
            <h2>Mapping Results</h2>
            <div id="mappingResults"></div>
            <div class="controls" style="margin-top: 15px;">
                <button class="btn-primary" onclick="exportResults()">Export Results (JSON)</button>
                <button class="btn-primary" onclick="exportCSV()">Export Results (CSV)</button>
            </div>
        </div>
    </div>

    <script>
        let currentImageIndex = 0;
        let products = [];
        let mappings = {};
        let imageFiles = [];

        // Generate image file list
        for (let i = 1; i <= 98; i++) {
            const num = String(i).padStart(5, '0');
            imageFiles.push(`image${num}.jpeg`);
        }

        // Products embedded directly (no fetch needed)
        const embeddedProducts = [{"name":"Slane Irish Whiskey","category":"Spirit","type":"Whiskey","price":42,"image":"/spirits/slane-irish-whiskey.jpg","hasGallery":false,"galleryCount":0},{"name":"Giffard Limoncello","category":"Spirit","type":"Liqueur","price":35,"image":"/spirits/giffard-limoncello.jpg","hasGallery":true,"galleryCount":1},{"name":"Absolut Vodka","category":"Spirit","type":"Vodka","price":37.5,"image":"/spirits/absolut-vodka.jpg","hasGallery":true,"galleryCount":1},{"name":"Clonakilty Galley Head Irish Whiskey","category":"Spirit","type":"Whiskey","price":43,"image":"/spirits/clonakilty-galley-head-irish-whiskey.jpg","hasGallery":true,"galleryCount":1},{"name":"Maker's Mark Kentucky Straight Bourbon Whisky","category":"Spirit","type":"Whiskey","price":55,"image":"/spirits/makers-mark-bourbon.jpg","hasGallery":false,"galleryCount":0},{"name":"R√©my Martin Cognac Fine Champagne V.S.O.P","category":"Spirit","type":"Liqueur","price":79.95,"image":"/spirits/remy-martin-vsop-cognac.jpg","hasGallery":false,"galleryCount":0},{"name":"Teeling Small Batch Irish Whiskey","category":"Spirit","type":"Whiskey","price":42,"image":"/spirits/teeling-small-batch-irish-whiskey.jpg","hasGallery":true,"galleryCount":1},{"name":"Chivas Regal 12 Year Old Blended Scotch Whisky","category":"Spirit","type":"Whiskey","price":49.95,"image":"/spirits/chivas-regal-12-year-old.jpg","hasGallery":true,"galleryCount":1},{"name":"Minke Irish Vodka","category":"Spirit","type":"Vodka","price":35,"image":"/spirits/minke-irish-vodka.jpg","hasGallery":false,"galleryCount":0},{"name":"Smirnoff No. 21 Vodka","category":"Spirit","type":"Vodka","price":24,"image":"/spirits/smirnoff-no21-vodka.jpg","hasGallery":true,"galleryCount":1},{"name":"Jim Beam Kentucky Straight Bourbon Whiskey","category":"Spirit","type":"Whiskey","price":36,"image":"/spirits/jim-beam-bourbon.jpg","hasGallery":false,"galleryCount":0},{"name":"Dingle Original Gin","category":"Spirit","type":"Gin","price":39.5,"image":"/spirits/dingle-original-gin.jpg","hasGallery":false,"galleryCount":0},{"name":"Heaven's Door Tennessee Bourbon","category":"Spirit","type":"Whiskey","price":89,"image":"/spirits/heavens-door-tennessee-bourbon.jpg","hasGallery":false,"galleryCount":0},{"name":"Blue Spot Single Pot Still Irish Whiskey","category":"Spirit","type":"Whiskey","price":115,"image":"/spirits/blue-spot-irish-whiskey.jpg","hasGallery":false,"galleryCount":0},{"name":"Red Spot Single Pot Still Irish Whiskey","category":"Spirit","type":"Whiskey","price":150,"image":"/spirits/red-spot-irish-whiskey.jpg","hasGallery":true,"galleryCount":1},{"name":"Red Spot Single Pot Still 19 Year Old Irish Whiskey","category":"Spirit","type":"Whiskey","price":695,"image":"/spirits/red-spot-19-year-old.jpg","hasGallery":false,"galleryCount":0},{"name":"Chivas Regal 18 Year Old Blended Scotch Whisky","category":"Spirit","type":"Whiskey","price":99,"image":"/spirits/chivas-regal-18-year-old.jpg","hasGallery":false,"galleryCount":0},{"name":"Yellow Spot Single Pot Still Irish Whiskey","category":"Spirit","type":"Whiskey","price":95.95,"image":"/spirits/yellow-spot-irish-whiskey.jpg","hasGallery":false,"galleryCount":0},{"name":"Minke Irish Gin","category":"Spirit","type":"Gin","price":45,"image":"/spirits/minke-irish-gin.jpg","hasGallery":false,"galleryCount":0},{"name":"Teacher's Highland Cream Blended Scotch Whisky","category":"Spirit","type":"Whiskey","price":29.9,"image":"/spirits/teachers-highland-cream.jpg","hasGallery":false,"galleryCount":0},{"name":"Green Spot Single Pot Still Irish Whiskey","category":"Spirit","type":"Whiskey","price":65,"image":"/spirits/green-spot-irish-whiskey.jpg","hasGallery":true,"galleryCount":1},{"name":"The Balvenie Caribbean Cask Aged 14 Years","category":"Spirit","type":"Whiskey","price":125,"image":"/spirits/balvenie-caribbean-cask-14.jpg","hasGallery":false,"galleryCount":0},{"name":"Mars Maltage Cosmo Blended Malt Whisky","category":"Spirit","type":"Whiskey","price":89,"image":"/spirits/mars-maltage-cosmo.jpg","hasGallery":false,"galleryCount":0},{"name":"Bushmills Single Malt 10 Year Old Irish Whiskey","category":"Spirit","type":"Whiskey","price":59.95,"image":"/spirits/bushmills-single-malt.jpg","hasGallery":true,"galleryCount":1},{"name":"Bushmills 16 Year Old Single Malt Irish Whiskey","category":"Spirit","type":"Whiskey","price":128,"image":"/spirits/bushmills-16-year-old.jpg","hasGallery":false,"galleryCount":0},{"name":"Bushmills 2011 The Causeway Collection Irish Whiskey","category":"Spirit","type":"Whiskey","price":115,"image":"/spirits/bushmills-2011-causeway-collection.jpg","hasGallery":false,"galleryCount":0},{"name":"Hendrick's Gin","category":"Spirit","type":"Gin","price":49,"image":"/spirits/hendricks-gin.jpg","hasGallery":false,"galleryCount":0},{"name":"Glendalough Porter Cask Single Malt Irish Whiskey","category":"Spirit","type":"Whiskey","price":89,"image":"/spirits/glendalough-porter-cask.jpg","hasGallery":false,"galleryCount":0},{"name":"Diplomatico Mantuano Rum","category":"Spirit","type":"Rum","price":49,"image":"/spirits/diplomatico-mantuano-rum.jpg","hasGallery":true,"galleryCount":1},{"name":"Glendalough Double Barrel Irish Whiskey","category":"Spirit","type":"Whiskey","price":66,"image":"/spirits/glendalough-double-barrel.jpg","hasGallery":true,"galleryCount":1},{"name":"Glendalough Pot Still Triple Casked Irish Whiskey","category":"Spirit","type":"Whiskey","price":66,"image":"/spirits/glendalough-pot-still-triple-casked.jpg","hasGallery":false,"galleryCount":0},{"name":"Brockmans Intensely Smooth Gin","category":"Spirit","type":"Gin","price":50,"image":"/spirits/brockmans-gin.jpg","hasGallery":false,"galleryCount":0},{"name":"Jack Daniel's Single Barrel Select Tennessee Whiskey","category":"Spirit","type":"Whiskey","price":69.5,"image":"/spirits/jack-daniels-single-barrel-select.jpg","hasGallery":true,"galleryCount":1},{"name":"Duppy Share Spiced Rum","category":"Spirit","type":"Rum","price":44.5,"image":"/spirits/duppy-share-spiced-rum.jpg","hasGallery":false,"galleryCount":0},{"name":"Buffalo Trace Kentucky Straight Bourbon Whiskey","category":"Spirit","type":"Whiskey","price":50,"image":"/spirits/buffalo-trace-bourbon.jpg","hasGallery":false,"galleryCount":0},{"name":"Bumbu Rum","category":"Spirit","type":"Rum","price":38,"image":"/spirits/bumbu-rum.jpg","hasGallery":false,"galleryCount":0},{"name":"Olmeca Tequila Reposado","category":"Spirit","type":"Tequila","price":35.99,"image":"/spirits/olmeca-tequila-reposado.jpg","hasGallery":false,"galleryCount":0},{"name":"Five Farms Single Batch Irish Cream Liqueur","category":"Spirit","type":"Liqueur","price":37.95,"image":"/spirits/five-farms-irish-cream.jpg","hasGallery":false,"galleryCount":0},{"name":"William Lawson's Blended Scotch Whisky","category":"Spirit","type":"Whiskey","price":31.5,"image":"/spirits/william-lawsons-scotch.jpg","hasGallery":false,"galleryCount":0},{"name":"Tanqueray No. Ten Gin","category":"Spirit","type":"Gin","price":49.95,"image":"/spirits/tanqueray-no10-gin.jpg","hasGallery":false,"galleryCount":0},{"name":"Woodford Reserve Kentucky Straight Bourbon Whiskey","category":"Spirit","type":"Whiskey","price":58,"image":"/spirits/woodford-reserve-bourbon.jpg","hasGallery":false,"galleryCount":0},{"name":"Jose Cuervo Especial Reposado Tequila","category":"Spirit","type":"Tequila","price":39.95,"image":"/spirits/jose-cuervo-especial-reposado.jpg","hasGallery":false,"galleryCount":0},{"name":"1800 A√±ejo Tequila","category":"Spirit","type":"Tequila","price":65,"image":"/spirits/1800-anejo-tequila.jpg","hasGallery":false,"galleryCount":0},{"name":"Patr√≥n Reposado Tequila","category":"Spirit","type":"Tequila","price":90,"image":"/spirits/patron-tequila.jpg","hasGallery":true,"galleryCount":1},{"name":"Jack Daniel's Gentleman Jack","category":"Spirit","type":"Whiskey","price":53.5,"image":"/spirits/jack-daniels-gentleman-jack.jpg","hasGallery":false,"galleryCount":0},{"name":"Bulleit Bourbon Frontier Whiskey","category":"Spirit","type":"Whiskey","price":43,"image":"/spirits/bulleit-bourbon.jpg","hasGallery":false,"galleryCount":0},{"name":"Powers Gold Label Irish Whiskey","category":"Spirit","type":"Whiskey","price":36.95,"image":"/spirits/powers-irish-whiskey.jpg","hasGallery":true,"galleryCount":1},{"name":"Connemara Peated Single Malt Irish Whiskey","category":"Spirit","type":"Whiskey","price":45.5,"image":"/spirits/connemara-peated-single-malt.jpg","hasGallery":false,"galleryCount":0},{"name":"Chambord Black Raspberry Liqueur","category":"Spirit","type":"Liqueur","price":29,"image":"/spirits/chambord-black-raspberry-liqueur.jpg","hasGallery":false,"galleryCount":0},{"name":"Gin Mare Mediterranean Gin","category":"Spirit","type":"Gin","price":55,"image":"/spirits/gin-mare.jpg","hasGallery":false,"galleryCount":0},{"name":"Johnnie Walker Double Black Blended Scotch Whisky","category":"Spirit","type":"Whiskey","price":105,"image":"/spirits/johnnie-walker-double-black.jpg","hasGallery":true,"galleryCount":1},{"name":"Johnnie Walker Gold Label Reserve Blended Scotch Whisky","category":"Spirit","type":"Whiskey","price":95,"image":"/spirits/johnnie-walker-gold-label-reserve.jpg","hasGallery":true,"galleryCount":1},{"name":"Johnnie Walker Red Label Blended Scotch Whisky","category":"Spirit","type":"Whiskey","price":34.95,"image":"/spirits/johnnie-walker-red-label.jpg","hasGallery":true,"galleryCount":1},{"name":"Jameson Original Irish Whiskey","category":"Spirit","type":"Whiskey","price":30.5,"image":"/spirits/jameson-original.jpg","hasGallery":true,"galleryCount":1},{"name":"Bushmills The Original Irish Whiskey","category":"Spirit","type":"Whiskey","price":32.5,"image":"/spirits/bushmills-the-original.jpg","hasGallery":true,"galleryCount":1},{"name":"Martini Extra Dry Vermouth","category":"Spirit","type":"Liqueur","price":16.95,"image":"/spirits/martini-extra-dry.jpg","hasGallery":true,"galleryCount":1},{"name":"Jack Daniel's Old No. 7 Tennessee Whiskey","category":"Spirit","type":"Whiskey","price":38.95,"image":"/spirits/jack-daniels-old-no7.jpg","hasGallery":true,"galleryCount":1},{"name":"Sandeman Ruby Porto","category":"Wine","type":"Red","price":28.99,"image":"/spirits/sandeman-ruby-porto.jpg","hasGallery":true,"galleryCount":1},{"name":"Sandeman Tawny Porto","category":"Wine","type":"Red","price":27.99,"image":"/spirits/sandeman-tawny-porto.jpg","hasGallery":true,"galleryCount":1},{"name":"Ocho Tequila Blanco","category":"Spirit","type":"Tequila","price":52,"image":"/spirits/ocho-tequila-blanco.jpg","hasGallery":true,"galleryCount":1},{"name":"Redbreast 21 Year Old Single Pot Still Irish Whiskey","category":"Spirit","type":"Whiskey","price":275,"image":"/spirits/redbreast-21-year-old.jpg","hasGallery":false,"galleryCount":0},{"name":"Bushmills Black Bush Irish Whiskey","category":"Spirit","type":"Whiskey","price":0,"image":"/spirits/bushmills-black-bush.jpg","hasGallery":true,"galleryCount":1},{"name":"Disaronno Originale Amaretto Liqueur","category":"Spirit","type":"Liqueur","price":34.5,"image":"/spirits/disaronno-originale.jpg","hasGallery":true,"galleryCount":1},{"name":"Tequila Rose Strawberry Cream Liqueur","category":"Spirit","type":"Liqueur","price":23.9,"image":"/spirits/tequila-rose-strawberry-cream.jpg","hasGallery":true,"galleryCount":1},{"name":"Tequila Rose Strawberry Cream Liqueur","category":"Spirit","type":"Liqueur","price":29.5,"image":"/spirits/tequila-rose-strawberry-cream-700ml.jpg","hasGallery":false,"galleryCount":0},{"name":"Tails Cocktails Espresso Martini","category":"Spirit","type":"Liqueur","price":24,"image":"/spirits/tails-espresso-martini.jpg","hasGallery":true,"galleryCount":1},{"name":"Glendalough Wild Botanical Irish Gin","category":"Spirit","type":"Gin","price":45,"image":"/spirits/glendalough-wild-botanical-gin.jpg","hasGallery":true,"galleryCount":1},{"name":"Drumshanbo Gunpowder Irish Gin","category":"Spirit","type":"Gin","price":47,"image":"/spirits/drumshanbo-gunpowder-gin.jpg","hasGallery":true,"galleryCount":1},{"name":"Redbreast Pedro Xim√©nez PX Edition Single Pot Still Irish Whiskey","category":"Spirit","type":"Whiskey","price":105,"image":"/spirits/redbreast-px-edition.jpg","hasGallery":true,"galleryCount":1},{"name":"El Jimador Tequila Blanco","category":"Spirit","type":"Tequila","price":42,"image":"/spirits/el-jimador-blanco.jpg","hasGallery":true,"galleryCount":1},{"name":"Jameson Crested Irish Whiskey","category":"Spirit","type":"Whiskey","price":0,"image":"/spirits/jameson-crested.jpg","hasGallery":true,"galleryCount":1},{"name":"KAH Tequila Reposado","category":"Spirit","type":"Tequila","price":77,"image":"/spirits/kah-tequila-reposado.jpg","hasGallery":true,"galleryCount":1},{"name":"Glenfiddich 12 Year Old Single Malt Scotch Whisky","category":"Spirit","type":"Whiskey","price":72,"image":"/spirits/glenfiddich-12-year-old.jpg","hasGallery":true,"galleryCount":1},{"name":"The Macallan 12 Year Old Double Cask Single Malt Scotch Whisky","category":"Spirit","type":"Whiskey","price":120,"image":"/spirits/macallan-12-double-cask.jpg","hasGallery":true,"galleryCount":1},{"name":"J√§germeister Herbal Liqueur","category":"Spirit","type":"Liqueur","price":32,"image":"/spirits/jagermeister.jpg","hasGallery":true,"galleryCount":1},{"name":"Plantation 3 Stars White Rum","category":"Spirit","type":"Rum","price":42.95,"image":"/spirits/plantation-3-stars-rum.jpg","hasGallery":true,"galleryCount":1},{"name":"Diplomatico Reserva Exclusiva Rum","category":"Spirit","type":"Rum","price":60,"image":"/spirits/diplomatico-reserva-exclusiva.jpg","hasGallery":true,"galleryCount":1},{"name":"Jameson Black Barrel Irish Whiskey","category":"Spirit","type":"Whiskey","price":0,"image":"/spirits/jameson-black-barrel.jpg","hasGallery":true,"galleryCount":1},{"name":"Jameson Triple Triple Irish Whiskey","category":"Spirit","type":"Whiskey","price":0,"image":"/spirits/jameson-triple-triple.jpg","hasGallery":true,"galleryCount":1},{"name":"Herradura Tequila Reposado","category":"Spirit","type":"Tequila","price":69,"image":"/spirits/herradura-reposado.jpg","hasGallery":true,"galleryCount":1},{"name":"Kopke 10 Year Old Tawny Porto","category":"Wine","type":"Red","price":35,"image":"/spirits/kopke-10-year-tawny-porto.jpg","hasGallery":false,"galleryCount":0},{"name":"A Winter's Tale Medium Sweet Sherry","category":"Wine","type":"White","price":20,"image":"/spirits/winters-tale-sherry.jpg","hasGallery":false,"galleryCount":0},{"name":"Quinta Vale D. Maria Late Bottled Vintage Porto 2016","category":"Wine","type":"Red","price":38.5,"image":"/spirits/quinta-vale-d-maria-lbv-2016.jpg","hasGallery":false,"galleryCount":0}];

        // Load products (embedded, no fetch needed)
        function loadProducts() {
            products = embeddedProducts;
            console.log(`Loaded ${products.length} products`);
            renderProducts();
            updateStats();
            
            // Add event listener for search box
            document.getElementById('searchBox').addEventListener('input', filterProducts);
        }

        function renderProducts() {
            const productList = document.getElementById('productList');
            productList.innerHTML = products.map((product, index) => `
                <div class="product-item" onclick="selectProduct(${index})" id="product-${index}">
                    <div class="product-name">${product.name}</div>
                    <div class="product-details">${product.category} - ${product.type} | ‚Ç¨${product.price} | Gallery: ${product.hasGallery ? 'Yes' : 'No'}</div>
                </div>
            `).join('');
        }

        function filterProducts() {
            if (products.length === 0) {
                console.log('Products not loaded yet');
                return;
            }
            
            const searchTerm = document.getElementById('searchBox').value.toLowerCase().trim();
            const items = document.querySelectorAll('.product-item');
            
            if (searchTerm === '') {
                // Show all products if search is empty
                items.forEach(item => {
                    item.style.display = 'block';
                });
                return;
            }
            
            items.forEach((item, index) => {
                if (index >= products.length) return;
                
                const product = products[index];
                if (!product) return;
                
                const match = (product.name && product.name.toLowerCase().includes(searchTerm)) ||
                            (product.category && product.category.toLowerCase().includes(searchTerm)) ||
                            (product.type && product.type.toLowerCase().includes(searchTerm));
                item.style.display = match ? 'block' : 'none';
            });
        }

        let selectedProductIndex = null;

        function selectProduct(index) {
            // Remove previous selection
            document.querySelectorAll('.product-item').forEach(item => {
                item.style.border = '2px solid #ddd';
            });
            
            // Highlight selected
            const item = document.getElementById(`product-${index}`);
            item.style.border = '3px solid #8B0000';
            selectedProductIndex = index;
        }

        function loadImage(index) {
            const imageName = imageFiles[index];
            const imagePath = `../spirits_list/${imageName}`;
            document.getElementById('currentImage').src = imagePath;
            document.getElementById('imageInfo').textContent = imageName;
            currentImageIndex = index;
            
            // Check if already mapped
            if (mappings[imageName]) {
                const mapping = mappings[imageName];
                const productIndex = products.findIndex(p => p.name === mapping.product);
                if (productIndex !== -1) {
                    selectProduct(productIndex);
                }
            }
        }

        function nextImage() {
            if (currentImageIndex < imageFiles.length - 1) {
                loadImage(currentImageIndex + 1);
            }
        }

        function previousImage() {
            if (currentImageIndex > 0) {
                loadImage(currentImageIndex - 1);
            }
        }

        function matchAsMain() {
            if (selectedProductIndex === null) {
                alert('Please select a product first');
                return;
            }
            const product = products[selectedProductIndex];
            const imageName = imageFiles[currentImageIndex];
            mappings[imageName] = {
                product: product.name,
                type: 'main',
                category: product.category
            };
            markProductAsMatched(selectedProductIndex);
            updateStats();
            updateMappingResults();
        }

        function matchAsGallery() {
            if (selectedProductIndex === null) {
                alert('Please select a product first');
                return;
            }
            const product = products[selectedProductIndex];
            const imageName = imageFiles[currentImageIndex];
            mappings[imageName] = {
                product: product.name,
                type: 'gallery',
                category: product.category
            };
            markProductAsMatched(selectedProductIndex);
            updateStats();
            updateMappingResults();
        }

        function markAsNewProduct() {
            const imageName = imageFiles[currentImageIndex];
            mappings[imageName] = {
                product: 'NEW PRODUCT - NEEDS IDENTIFICATION',
                type: 'unknown',
                category: 'Unknown'
            };
            updateStats();
            updateMappingResults();
        }

        function markProductAsMatched(index) {
            const item = document.getElementById(`product-${index}`);
            item.classList.add('matched');
        }

        function updateStats() {
            const matched = Object.keys(mappings).length;
            document.getElementById('matchedCount').textContent = matched;
            document.getElementById('remainingCount').textContent = imageFiles.length - matched;
        }

        function updateMappingResults() {
            const resultsDiv = document.getElementById('mappingResults');
            const mapped = Object.entries(mappings).map(([image, data]) => 
                `<div class="mapping-item"><strong>${image}</strong> ‚Üí ${data.product} (${data.type})</div>`
            ).join('');
            resultsDiv.innerHTML = mapped || '<div>No mappings yet</div>';
        }

        function exportResults() {
            const dataStr = JSON.stringify(mappings, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'image-mappings.json';
            a.click();
        }

        function exportCSV() {
            const csv = ['Image,Product,Type,Category'];
            Object.entries(mappings).forEach(([image, data]) => {
                csv.push(`${image},"${data.product}",${data.type},${data.category}`);
            });
            const csvStr = csv.join('\n');
            const blob = new Blob([csvStr], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'image-mappings.csv';
            a.click();
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadProducts();
            loadImage(0);
            
            // Also try to load products directly if fetch fails
            setTimeout(() => {
                if (products.length === 0) {
                    console.warn('Products not loaded via fetch, trying alternative method...');
                    // This will be handled by the error message
                }
            }, 1000);
        });
    </script>
</body>
</html>

